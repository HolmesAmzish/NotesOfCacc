**考试分值**

填空题 8 分

不定项选择 8 分

综合应用 45 分

编程两题 ~35 分

# 无线传感网













ZigBee 路由协议：树形编址

Mesh 路由 两个数据结构



路由协议的分类 MAC 协议



传感器节点的组成，功能模块

数据采集 A/D 转换器



自动识别技术 RFID，有哪些自动识别技术

高频与低频工作的优缺点



IEEE 8021.4 超帧，信标帧

## 无线传感网的组织结构

网络层中，从汇聚节点到传感器节点的数据发送是一对多模式，采用泛洪的数据传输机制；从传感器节点到汇聚节点发送数据的方式是多对一，存在路由选择问题。

主要的路由协议包括数据分发协议、数据汇聚协议、数据洪范协议等；CTP 协议由链路估计器、路由引擎和转发引擎三部分组成



## MAC 协议

### 无线广播信道

无线传感网与有线传输形式不同，通过无线电、声音等媒介进行空间传播。人们利用若干个频段进行无线通信，

**隐藏站与暴露站问题**

- 隐藏站问题：无线信号覆盖范围有限，发送节点无法感知非覆盖范围内的其他发送者。当两个发送节点（如A和C）均未检测到对方的信号，同时向同一接收节点（如B）发送数据时，导致数据在接收端发生冲突。

- 暴露站问题：过度保守的信道监听机制导致带宽浪费。当某节点（如C）因检测到邻近节点（如B）的信号而误判信道繁忙，延迟发送数据，但实际上其目标节点（如D）并未被干扰。节点因检测到非相关信号的传输而过度保守延迟发送导致信道利用率下降的现象。

**信道预约**

为解决无线环境下的隐藏站问题，发送节点在发送数据之前与接收节点进行控制消息的握手交换，采用 RTS/CTS 信道预约的方式。其核心思想是在收发节点传输数据之前对无线信道进行预约，通知发送节点和接收节点的邻居节点即将开始的数据传输，这些邻居节点再次后的一段时间内暂停自己的传输操作，从而避免对即将进行的数据传输造成碰撞。

当源节点 S 有数据要传送时,首先检测无线信道是否空闲；如果空闲,则发送一个短的控制帧，叫做请求发送 RTS 帧(Request To Send)，该帧包括了发送节点的源地址、目的地址和本次通信需要的持续时间(含确认帧 ACK 的时间)信息。目的节点 D 收到 RTS 帧后，若信道空闲，则向源节点 S 回送一个响应控制 CTS 帧(Clear To Send),表示允许源节点发送数据。



## 路由协议

### LEACH 协议

LEACH 协议是一个代表性的分簇路由协议，它使用随机轮转在传感器节点之间平均分配能量负载。通过簇的建立和运行，进行无线传感器网络的局部协作和控制，利用局部压缩策略来减少全局的数据通信量，从而获得较好的能效。

**LEACH 协议工作过程**

1. 广播阶段，每个节点自行决定在本轮中是否成为簇头，节点 n 随机产生一个 0 到 1 之间的随机数来句诶的那个是否成为簇头，若随机数小于阈值，则成为本轮簇头，阈值设计如下
   $$
   T(n) = 
   \begin{cases}
   \frac{P}{1 - P\times(r \mod \frac{1}{P})}&, \text{if } n \in G \\
   0&, \text{其他}
   \end{cases}
   $$
   每个自我选举为簇头的节点广播信息给其他节点，所有簇头要用同样的发射能量发射，可以使非簇头节点判断到哪个簇头耗能最少，此时所有的非簇头节点打开射频接收器，选择最近的簇头并加入

2. 分簇建立阶段

3. 簇内成员调度阶段



### CTP 汇聚树协议

CTP（Collection Tree Protocol）是无线传感网中一种**数据汇聚路由协议**，属于**距离矢量路由算法**的变种。其核心目标是将分散的传感器节点数据通过多跳传输汇聚到根节点（Sink），形成以根节点为中心的树状拓扑。具有低开销、高可靠性、子修复能力。

CTP 协议中主要用到两种分组，即**数据分组**和**路由分组**，数据分组用于发送有效数据，而路由分组要叫做**信标**，用于生成和维护网络的树状路由结构。为传输信息，CTP协议只使用了链路层的 Data 帧和 Ack 帧，而 Data 帧封装了 CTP 路由协议的数据分组和路由分组。

|     **分组类型**     |                   **功能**                    |         **封装方式**          |
| :------------------: | :-------------------------------------------: | :---------------------------: |
|     **数据分组**     |  携带传感器采集的有效数据（如温度、湿度）。   |    封装在链路层Data帧中。     |
| **路由分组**（信标） | 维护树状拓扑，包含发送节点的ETX和父节点地址。 | 封装在链路层Data帧或Ack帧中。 |

**工作流程**

1. **初始化阶段**：

   根节点广播信标，声明自身为汇聚点（ETX=0）。

   邻居节点接收信标，计算到根的ETX（本地ETX + 父节点ETX）。

2. **路径建立阶段**：

   节点选择ETX最小的邻居作为父节点，加入汇聚树。

   周期性广播信标更新拓扑信息。

3. **数据传输阶段**：

   节点将数据包发送给父节点，逐跳转发至根节点。

   父节点通过ACK确认接收，失败时触发重传或路径修复。

   

### ZigBee 路由协议

基于 IEEE 802.15.4 标准的近距离、无线多跳网络路由协议，ZigBee 是一种新兴的短距离、低速率、低功耗的无线网络技术，主要用于近距离无线连接。

ZigBee 网络协议主要分为四层，物理层、介质访问控制MAC层、网络层和应用层。

按照网络角色，可以为 ZigBee 路由协议网络中的设备分为以下几类

| 类型     | 职责                                                | 硬件要求 |
| -------- | --------------------------------------------------- | -------- |
| 协调器   | 初始化网络，PAN ID 分配、管理设备入网               | FFD      |
| 路由器   | 扩展网络覆盖，转发数据包，参与路由发现              | FFD      |
| 终端设备 | 仅与父节点（协调器/路由其）通信，不参加路由，可休眠 | FFD/RFD  |

ZigBee 节点存在物理地址（MAC地址）和分配的网络地址。网络地址分配采用**树形编址**的方法，其为一种分层地址分配算法，父节点（协调器或路由器）负责为子节点分配地址。树形寻址方案分布性特征保证了设备只需要与它的父节点通信，提高节点地址分配效率。在每个设备加入之前，树形寻址方案需要知道一些网络参数，包括网络最大深度、最大路由孩子个数、节点最大孩子数等。



## 同步技术

## 数据感知与融合技术

## 其他核心技术

# TinyOS

## 微操作系统

## NesC 程序设计

TinyOS 采用组件化编程模型，核心包括

1. 模块（Module）

   实现具体功能，如传感器驱动、通信协议，包含命令（command）和事件（event）双向接口。实现具体功能逻辑。

   ```c
   #include "Timer.h"
   
   module BlinkC @safe() {
     uses interface Timer<TMilli> as Timer0;
     uses interface Timer<TMilli> as Timer1;
     uses interface Timer<TMilli> as Timer2;
     uses interface Leds;
     uses interface Boot;
   }
   
   implementation {
     event void Boot.booted () {
       call Timer0.startPeriodic( 250 );
       call Timer1.startPeriodic( 500 );
       call Timer2.startPeriodic( 1000 );
     }
   
     event void Timer0.fired () {
       dbg("BlinkC", "Timer 0 fired @ %s.\n", sim_time_string());
       call Leds.led0Toggle();
     }
     
     event void Timer1.fired () {
       dbg("BlinkC", "Timer 1 fired @ %s \n", sim_time_string());
       call Leds.led1Toggle();
     }
     
     event void Timer2.fired () {
       dbg("BlinkC", "Timer 2 fired @ %s.\n", sim_time_string());
       call Leds.led2Toggle();
     }
   }
   
   ```

2. 配置（Configuration）

   将多个模块通过接口连接，形成完整应用，使用 wriring 语法描述组件关系。连接其他组件，描述接口关系。

   ```c
   configuration BlinkAppC {}
   
   implementation {
     components MainC, BlinkC, LedsC;
     components new TimerMilliC() as Timer0;
     components new TimerMilliC() as Timer1;
     components new TimerMilliC() as Timer2;
   
     BlinkC -> MainC.Boot;
   
     BlinkC.Timer0 -> Timer0;
     BlinkC.Timer1 -> Timer1;
     BlinkC.Timer2 -> Timer2;
     BlinkC.Leds -> LedsC;
   }
   ```

   

## 应用开发



需要写出完整的程序，写出配置与模块

## 第一题 完成一个完整的简单程序

摩尔斯编码

数据采集、采集10个温度值

## 第二题 程序解析与填空

解读程序和填写语句，程序内容来自于实验，节点与PC机通信的内容