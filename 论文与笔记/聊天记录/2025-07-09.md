ä»¥ä¸‹æ˜¯é’ˆå¯¹æä¾›çš„æ•°æ®åº“è¡¨æ•°æ®çš„åˆ†æç»“æœï¼ŒæŒ‰åŠŸèƒ½æ¨¡å—å’Œå…³é”®ç‰¹å¾åˆ†ç±»æ•´ç†ï¼š

------

### **1. è¡¨åˆ†ç±»ç»Ÿè®¡**

| **åˆ†ç±»**       | **è¡¨æ•°é‡** | **ç¤ºä¾‹è¡¨å**                                       |
| -------------- | ---------- | -------------------------------------------------- |
| **æµç¨‹ç®¡ç†**   | 8          | `JC_Process`, `JC_Process_Finish`, `Process_Route` |
| **åº“å­˜ä¸ç‰©æ–™** | 7          | `JC_Stock`, `JC_ICMO`, `JC_BaseItem`               |
| **åŸºç¡€æ•°æ®**   | 6          | `JC_Dept`, `JC_Emp`, `JC_Unit`                     |
| **æ—¥å¿—ä¸ç›‘æ§** | 4          | `JC_Log_Record`, `Sys_Work_Log`                    |
| **ä¸´æ—¶è¡¨**     | 5          | `JC_ICMOEntryTemp`, `Process_RouteEntryTemp`       |
| **ç³»ç»Ÿé…ç½®**   | 3          | `Sys_Power111`, `Sys_module_list`                  |

------

### **2. å…³é”®è¡¨åˆ†æ**

#### **é«˜é¢‘æ ¸å¿ƒè¡¨**

| **è¡¨å**        | **æœ€åä¿®æ”¹æ—¶é—´**    | **è®°å½•æ•°** | **ç”¨é€”æ¨æµ‹**                       |
| --------------- | ------------------- | ---------- | ---------------------------------- |
| `JC_Process`    | 2025-05-27 15:41:25 | 13         | ä¸»æµç¨‹å®šä¹‰è¡¨                       |
| `JC_ICMO`       | 2025-06-13 08:49:29 | 11         | å·¥å•/ç”Ÿäº§æŒ‡ä»¤ç®¡ç†                  |
| `JC_DataSource` | 2024-06-27 14:11:01 | 59         | æ•°æ®æºé…ç½®ï¼ˆå¯èƒ½å­˜å‚¨å¤–éƒ¨ç³»ç»Ÿè¿æ¥ï¼‰ |
| `JC_Dispose`    | 2025-06-10 10:44:45 | 12         | å¤„ç½®ç®¡ç†ï¼ˆå¦‚æŠ¥åºŸã€è¿”å·¥ï¼‰           |

#### **ç‰¹æ®Šè¡¨**

- **`xt_user`** & **`xt_bbxx`**
  - å‘½åå‰ç¼€ `xt_` å¯èƒ½è¡¨ç¤ºç³»ç»Ÿæ ¸å¿ƒè¡¨ï¼ˆå¦‚ç”¨æˆ·ã€æƒé™ï¼‰ã€‚
  - `xt_bbxx` æœ€åä¿®æ”¹äº 2024-05-20ï¼Œè®°å½•æ•° 6ï¼Œå¯èƒ½æ˜¯åŸºç¡€ä¿¡æ¯è¡¨ã€‚
- **`Sys_Power111`**
  - éæ ‡å‡†å‘½åï¼ˆå«æ•°å­—åç¼€ï¼‰ï¼Œå¯èƒ½æ˜¯æƒé™è¡¨çš„æµ‹è¯•ç‰ˆæœ¬æˆ–ä¸´æ—¶ç‰ˆæœ¬ã€‚

------

### **3. æ—¶é—´çº¿åˆ†æ**

- **æœ€æ´»è·ƒè¡¨**
   `JC_Process_Finish`ï¼ˆ2025-06-30 æœ€åä¿®æ”¹ï¼Œ50 æ¡è®°å½•ï¼‰å’Œ `JC_ICMOEntry`ï¼ˆ2025-07-07 æœ€åä¿®æ”¹ï¼Œ30 æ¡è®°å½•ï¼‰è¿‘æœŸé¢‘ç¹æ›´æ–°ï¼Œå¯èƒ½æ˜¯æ ¸å¿ƒä¸šåŠ¡è¡¨ã€‚
- **é•¿æœŸæœªæ›´æ–°è¡¨**
   `JC_Material_Temp`ï¼ˆ2024-01-08 åˆ›å»ºåæœªä¿®æ”¹ï¼‰å’Œ `JC_Reason`ï¼ˆ2024-01-03 åˆ›å»ºåæœªä¿®æ”¹ï¼‰å¯èƒ½å·²å¼ƒç”¨ã€‚

------

### **4. å‘½åè§„å¾‹**

- **å‰ç¼€å«ä¹‰**
  - `JC_`ï¼šä¸šåŠ¡è¡¨ï¼ˆå¦‚ `JC_Process`, `JC_Stock`ï¼‰
  - `Sys_`ï¼šç³»ç»Ÿè¡¨ï¼ˆå¦‚ `Sys_module_list`ï¼‰
  - `xt_`ï¼šå¯èƒ½æ˜¯æ ¸å¿ƒç³»ç»Ÿè¡¨ï¼ˆå¦‚ `xt_user`ï¼‰
  - `Temp`ï¼šä¸´æ—¶è¡¨ï¼ˆå¦‚ `JC_ICMOEntryTemp`ï¼‰
- **åç¼€æ¨¡å¼**
  - `Entry`ï¼šæ˜ç»†è¡¨ï¼ˆå¦‚ `JC_ICMOEntry`ï¼‰
  - `_Reason`ï¼šåŸå› è®°å½•è¡¨ï¼ˆå¦‚ `JC_Process_Finish_Reason`ï¼‰
  - `_Emp`ï¼šå‘˜å·¥å…³è”è¡¨ï¼ˆå¦‚ `JC_Process_InStock_Emp`ï¼‰

------

### **5. æ½œåœ¨é—®é¢˜**

1. **å†—ä½™è¡¨**
   - `Sys_Power111` å’Œ `Sys_Power_List` å¯èƒ½å­˜åœ¨é‡å¤åŠŸèƒ½ã€‚
   - `JC_ICMOEntryTemp` ä¸ `JC_ICMOEntryTempNew` ç–‘ä¼¼æ–°æ—§ç‰ˆæœ¬å…±å­˜ã€‚
2. **ä¸´æ—¶è¡¨æœªæ¸…ç†**
    å¦‚ `JC_BaseSupplierDetailTemp`ï¼ˆ2024-03-25 åˆ›å»ºï¼‰é•¿æœŸæœªåˆ é™¤ï¼Œå¯èƒ½å ç”¨å­˜å‚¨ç©ºé—´ã€‚
3. **å‘½åä¸è§„èŒƒ**
   - `T`ã€`Rw`ã€`Rwd` ç­‰å•å­—æ¯/ç¼©å†™è¡¨åéš¾ä»¥ç†è§£ç”¨é€”ã€‚
   - `Sys_Power111` æ•°å­—åç¼€ç¼ºä¹è§£é‡Šã€‚

------

### **6. ä¼˜åŒ–å»ºè®®**

1. **åˆå¹¶ç›¸ä¼¼è¡¨**

   - æ£€æŸ¥ `Sys_Power111` å’Œ `Sys_Power_List` çš„åŠŸèƒ½é‡å æƒ…å†µã€‚
   - è¯„ä¼° `JC_ICMOEntryTemp` ä¸ `JC_ICMOEntryTempNew` çš„å·®å¼‚ï¼Œä¿ç•™å…¶ä¸€ã€‚

2. **æ¸…ç†ä¸´æ—¶è¡¨**

   ```
   DROP TABLE IF EXISTS JC_BaseSupplierDetailTemp, JC_ICMOEntryTemp;
   ```

3. **æ ‡å‡†åŒ–å‘½å**

   - å°† `T`ã€`Rw` é‡å‘½åä¸ºæœ‰æ„ä¹‰çš„åç§°ï¼ˆå¦‚ `JC_Transaction`ï¼‰ã€‚
   - ç»Ÿä¸€å‰ç¼€è§„åˆ™ï¼ˆå¦‚æ‰€æœ‰ç³»ç»Ÿè¡¨ç”¨ `Sys_`ï¼Œä¸šåŠ¡è¡¨ç”¨ `JC_`ï¼‰ã€‚

4. **å½’æ¡£æ—§æ•°æ®**

   - å¯¹é•¿æœŸæœªä¿®æ”¹çš„è¡¨ï¼ˆå¦‚ `JC_Material_Temp`ï¼‰è¿›è¡Œå½’æ¡£æˆ–åˆ é™¤ã€‚

------

### **æ€»ç»“**

- **æ ¸å¿ƒæ¨¡å—**ï¼šæµç¨‹ç®¡ç†ï¼ˆ`JC_Process`ï¼‰ã€ç”Ÿäº§å·¥å•ï¼ˆ`JC_ICMO`ï¼‰ã€åº“å­˜ï¼ˆ`JC_Stock`ï¼‰ã€‚
- **é£é™©ç‚¹**ï¼šä¸´æ—¶è¡¨æœªæ¸…ç†ã€å‘½åæ··ä¹±ã€æ½œåœ¨å†—ä½™è¡¨ã€‚
- **è¡ŒåŠ¨é¡¹**ï¼šä¼˜å…ˆåˆå¹¶/æ¸…ç†æ ‡è®°çš„è¡¨ï¼Œè§„èŒƒå‘½åï¼Œå»ºç«‹å®šæœŸç»´æŠ¤æœºåˆ¶ã€‚

å¦‚éœ€æ›´è¯¦ç»†çš„æŸå¼ è¡¨åˆ†æï¼Œè¯·æŒ‡å®šè¡¨åï¼ ğŸ”



ä½ å½“å‰çš„ä»£ç æ˜¯åŸºäº **åŸç”Ÿ ADO.NET + å­˜å‚¨è¿‡ç¨‹** å®ç°çš„æ•°æ®è®¿é—®é€»è¾‘ï¼Œç»“æ„æ¸…æ™°ã€åŠŸèƒ½å®Œæ•´ã€‚å¦‚æœä½ å¸Œæœ›ä½¿ç”¨ **Entity Frameworkï¼ˆEFï¼‰+ å­˜å‚¨è¿‡ç¨‹** æ¥é‡å†™è¿™ä¸ªé¡¹ç›®ï¼Œå¯ä»¥å®ç°æ›´ç®€æ´ã€å¯ç»´æŠ¤æ€§æ›´é«˜çš„ä»£ç ã€‚

---

## âœ… ç›®æ ‡

å°†ä»¥ä¸‹å†…å®¹ä½¿ç”¨ **Entity Framework Core + å­˜å‚¨è¿‡ç¨‹** å®ç°ï¼š

- ä½¿ç”¨ EF Core è°ƒç”¨å­˜å‚¨è¿‡ç¨‹
- ä¿ç•™å®ä½“ç±» `EmployeeEntity`
- ç®€åŒ–æ•°æ®è®¿é—®å±‚é€»è¾‘ï¼ˆ`EmployeeRepository`ï¼‰
- æ§åˆ¶å™¨ä¿æŒä¸å˜æˆ–ä»…åšå°‘é‡ä¿®æ”¹

---

## ğŸ“ ä¸€ã€é¡¹ç›®ç»“æ„è°ƒæ•´å»ºè®®

| å±‚çº§             | å†…å®¹               |
| ---------------- | ------------------ |
| Models           | `EmployeeEntity`   |
| Data (DbContext) | EFä¸Šä¸‹æ–‡           |
| Repository       | ä½¿ç”¨EFè°ƒç”¨å­˜å‚¨è¿‡ç¨‹ |
| Controllers      | ä¸å˜               |

---

## ğŸ”§ äºŒã€1. ä¿®æ”¹å®ä½“ç±»ï¼ˆOptionalï¼‰

ä½ å¯ä»¥æ ¹æ®éœ€è¦å¯¹ `EmployeeEntity` è¿›è¡Œé€‚å½“è°ƒæ•´ï¼Œæ¯”å¦‚åŠ ä¸Š `[Key]` ç­‰å±æ€§ï¼Œä½†å¦‚æœä½ åªæ˜¯æ˜ å°„æŸ¥è¯¢ç»“æœï¼Œå¯ä»¥ä¸åŠ ã€‚

```csharp
public class EmployeeEntity
{
    public int EmployeeId { get; set; }
    public string EmployeeName { get; set; }
    public string Gender { get; set; }
    public DateTime? BirthDate { get; set; }
    public string Email { get; set; }
    public string Phone { get; set; }
    public DateTime? HireDate { get; set; }
    public string Department { get; set; }
    public string Position { get; set; }
    public decimal? Salary { get; set; }
    public bool IsActive { get; set; }
}
```

---

## ğŸ”§ äºŒã€2. åˆ›å»º DbContext

åˆ›å»ºä¸€ä¸ª `AppDbContext.cs` æ–‡ä»¶ï¼š

```csharp
using Microsoft.EntityFrameworkCore;

namespace ArERP.Data
{
    public class AppDbContext : DbContext
    {
        public AppDbContext(DbContextOptions<AppDbContext> options) : base(options)
        {
        }

        // å¯ä»¥ä¸æ˜ å°„ DbSet<EmployeeEntity>ï¼Œå› ä¸ºæˆ‘ä»¬åªç”¨äºå­˜å‚¨è¿‡ç¨‹è¿”å›å€¼
    }
}
```

---

## ğŸ§© ä¸‰ã€å®šä¹‰å­˜å‚¨è¿‡ç¨‹è¿”å›ç±»å‹ï¼ˆå¯é€‰ï¼‰

å¦‚æœå­˜å‚¨è¿‡ç¨‹è¿”å›å­—æ®µä¸ `EmployeeEntity` å®Œå…¨ä¸€è‡´ï¼Œå¯ä»¥ç›´æ¥å¤ç”¨å®ƒã€‚å¦åˆ™å¯ä»¥æ–°å»ºä¸€ä¸ªç±»ï¼Œå¦‚ï¼š

```csharp
public class EmployeeViewModel
{
    public int EmployeeId { get; set; }
    public string EmployeeName { get; set; }
    public string Gender { get; set; }
    public DateTime? BirthDate { get; set; }
    public string Email { get; set; }
    public string Phone { get; set; }
    public DateTime? HireDate { get; set; }
    public string Department { get; set; }
    public string Position { get; set; }
    public decimal? Salary { get; set; }
    public bool IsActive { get; set; }
}
```

---

## ğŸ§  å››ã€ä½¿ç”¨ EF Core è°ƒç”¨å­˜å‚¨è¿‡ç¨‹

### æ–¹æ³•ï¼šä½¿ç”¨ `FromSqlRaw` æˆ– `ExecuteSqlRaw`

#### 1. è·å–æ‰€æœ‰å‘˜å·¥ï¼ˆGetAllEmployeesï¼‰

```csharp
var employees = await _context.EmployeeViewModels
    .FromSqlRaw("EXEC Get_Employees")
    .ToListAsync();
```

#### 2. è·å–å•ä¸ªå‘˜å·¥ï¼ˆGetEmployeeByIdï¼‰

```csharp
var employee = await _context.EmployeeViewModels
    .FromSqlRaw("EXEC Get_Employee @EmployeeId", new SqlParameter("@EmployeeId", id))
    .FirstOrDefaultAsync();
```

#### 3. æ’å…¥å‘˜å·¥ï¼ˆAddEmployeeï¼‰

å¦‚æœä½ å¸Œæœ›ç»§ç»­ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹æ’å…¥æ•°æ®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ EF è°ƒç”¨ï¼š

```csharp
await _context.Database.ExecuteSqlRawAsync(
    "EXEC Insert_Employee @EmployeeName, @Gender, @BirthDate, @Email, @Phone, @HireDate, @Department, @Position, @Salary, @IsActive",
    new SqlParameter("@EmployeeName", employee.EmployeeName),
    new SqlParameter("@Gender", employee.Gender ?? (object)DBNull.Value),
    new SqlParameter("@BirthDate", employee.BirthDate ?? (object)DBNull.Value),
    new SqlParameter("@Email", employee.Email ?? (object)DBNull.Value),
    new SqlParameter("@Phone", employee.Phone ?? (object)DBNull.Value),
    new SqlParameter("@HireDate", employee.HireDate ?? (object)DBNull.Value),
    new SqlParameter("@Department", employee.Department ?? (object)DBNull.Value),
    new SqlParameter("@Position", employee.Position ?? (object)DBNull.Value),
    new SqlParameter("@Salary", employee.Salary ?? (object)DBNull.Value),
    new SqlParameter("@IsActive", employee.IsActive)
);
```

---

## ğŸ§± äº”ã€é‡æ„ Repository å±‚

```csharp
using System.Collections.Generic;
using System.Threading.Tasks;
using Microsoft.EntityFrameworkCore;
using ArERP.Models.Entity;
using ArERP.Data;

namespace ArERP.Repository
{
    public class EmployeeRepository
    {
        private readonly AppDbContext _context;

        public EmployeeRepository(AppDbContext context)
        {
            _context = context;
        }

        public async Task<List<EmployeeEntity>> GetAllEmployeesAsync()
        {
            return await _context.Set<EmployeeEntity>()
                .FromSqlRaw("EXEC Get_Employees")
                .ToListAsync();
        }

        public async Task<EmployeeEntity> GetEmployeeByIdAsync(int id)
        {
            return await _context.Set<EmployeeEntity>()
                .FromSqlRaw("EXEC Get_Employee @EmployeeId", new SqlParameter("@EmployeeId", id))
                .FirstOrDefaultAsync();
        }

        public async Task AddEmployeeAsync(EmployeeEntity employee)
        {
            await _context.Database.ExecuteSqlRawAsync(
                "EXEC Insert_Employee @EmployeeName, @Gender, @BirthDate, @Email, @Phone, @HireDate, @Department, @Position, @Salary, @IsActive",
                new SqlParameter("@EmployeeName", employee.EmployeeName ?? (object)DBNull.Value),
                new SqlParameter("@Gender", employee.Gender ?? (object)DBNull.Value),
                new SqlParameter("@BirthDate", employee.BirthDate ?? (object)DBNull.Value),
                new SqlParameter("@Email", employee.Email ?? (object)DBNull.Value),
                new SqlParameter("@Phone", employee.Phone ?? (object)DBNull.Value),
                new SqlParameter("@HireDate", employee.HireDate ?? (object)DBNull.Value),
                new SqlParameter("@Department", employee.Department ?? (object)DBNull.Value),
                new SqlParameter("@Position", employee.Position ?? (object)DBNull.Value),
                new SqlParameter("@Salary", employee.Salary ?? (object)DBNull.Value),
                new SqlParameter("@IsActive", employee.IsActive)
            );
        }
    }
}
```

---

## ğŸ–¥ï¸ å…­ã€Controller å±‚ä¿æŒä¸å˜ï¼ˆæˆ–ç¨ä½œå¼‚æ­¥ä¼˜åŒ–ï¼‰

```csharp
[HttpGet]
public async Task<IActionResult> Index()
{
    var employees = await _employeeRepository.GetAllEmployeesAsync();
    return View(employees);
}

[HttpPost]
public async Task<IActionResult> Create(EmployeeEntity employee)
{
    if (ModelState.IsValid)
    {
        await _employeeRepository.AddEmployeeAsync(employee);
        return RedirectToAction(nameof(Index));
    }
    return View(employee);
}
```

---

## âœ… ä¸ƒã€é…ç½® Startup.cs / Program.cs

ç¡®ä¿ä½ å·²ç»æ³¨å†Œäº† `AppDbContext`ï¼š

### ASP.NET Core 3.1 - 5.0ï¼ˆStartup.csï¼‰

```csharp
services.AddDbContext<AppDbContext>(options =>
    options.UseSqlServer(Configuration.GetConnectionString("DefaultConnection")));
```

### ASP.NET Core 6.0+ / .NET 7+ï¼ˆProgram.csï¼‰

```csharp
builder.Services.AddDbContext<AppDbContext>(options =>
    options.UseSqlServer(builder.Configuration.GetConnectionString("DefaultConnection")));
```

---

## ğŸ‰ æ€»ç»“

| åŸå§‹æ–¹å¼               | EF Core æ”¹é€ å             |
| ---------------------- | -------------------------- |
| æ‰‹åŠ¨æ‰“å¼€è¿æ¥ã€æ‰§è¡Œå‘½ä»¤ | EF è‡ªåŠ¨ç®¡ç†è¿æ¥            |
| SqlDataReader è§£æ     | FromSqlRaw æ˜ å°„å®ä½“        |
| å‚æ•°æ‰‹åŠ¨æ·»åŠ            | ä½¿ç”¨ SqlParameter ç»‘å®šå‚æ•° |
| åŒæ­¥æ–¹æ³•               | æ”¯æŒå¼‚æ­¥ï¼ˆæ¨èï¼‰           |
| æ²¡æœ‰ä¾èµ–æ³¨å…¥           | æ”¯æŒ DIï¼Œç»“æ„æ›´æ¸…æ™°        |

---

## ğŸ“¦ æ˜¯å¦éœ€è¦æˆ‘æä¾›å®Œæ•´çš„ EF Core + å­˜å‚¨è¿‡ç¨‹ Demo é¡¹ç›®ï¼Ÿ

å¦‚æœä½ æƒ³è¦è¿™ä¸ªé¡¹ç›®çš„å®Œæ•´æºç åŒ…ï¼ˆåŒ…å« `.csproj`, `Program.cs`, `Startup.cs`, `Models`, `Controllers`, `Views`ï¼‰ï¼Œæˆ‘å¯ä»¥ä¸ºä½ æ‰“åŒ…ç”Ÿæˆä¸€ä»½æ¨¡æ¿ã€‚

æ˜¯å¦è¦æˆ‘å¸®ä½ ç”Ÿæˆï¼ŸğŸ˜