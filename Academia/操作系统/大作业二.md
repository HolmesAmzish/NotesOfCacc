---
title: 操作系统大作业二 文件分配
date: 2025-05-07
---

# 操作系统大作业二 文件分配

一个文件系统中有一个20MB大文件和一个20KB小文件,当分别采用连续、链接、i-node(10个直接地址，一个一级间接、一个二级间接和一个三级间接)分配方案时，每块大小为4KB,每块地址用4B表示，问:

**(1)各文件系统管理的最大的文件是多少?**

在连续分配中，最大文件大小，仅受存储设备物理容量限制。

链接分配中，每块有效数据 = 块大小 - 指针大小 = 4096B - 4B = 4096B，$最大文件 = (2^{32} - 1) \times 4092\text{B} \approx 16\text{TB}$。

i-node 分配里

1. 直接地址：10 × 4KB = 40KB

2. 一级间接：(4KB/4B) × 4KB = 1024 × 4KB = 4MB

3. 二级间接：(4KB/4B)² × 4KB = 1,048,576 × 4KB = 4GB

4. 三级间接：(4KB/4B)³ × 4KB = 1,073,741,824 × 4KB = 4TB

   **​最大文件​**​ = 40KB + 4MB + 4GB + 4TB ≈ 4TB

   

**(2)每种方案对大、小两文件各需要多少专用块来记录文件的物理地址(说明各块的用途)?**

20 MB 大文件

| 方案     | 专用块数 | 用途说明                                                     |
| -------- | -------- | ------------------------------------------------------------ |
| 连续分配 | 1        | 1 个元数据块记录其实块号和块数                               |
| 链接分配 | 5120     | 每个数据块包含下一个块的指针，额外需要 FAT 表                |
| i-node   | 6        | 1个i-node块 + 1个一级间接块 + 4个二级间接块（管理5120-10-1024=4086块） |

20 KB 小文件

|方案|	专用块数|	用途说明|
|---|---|---|
|连续分配|	1|	1个元数据块记录起始块号和块数|
|链接分配	|5|	每个数据块包含指针，无需额外FAT表|
|i-node|	1|	仅使用i-node中的5个直接地址项|



**(3)如需要读大文件前面第5.5KB的信息和后面第（16M＋5.5KB）的信息，则每个方案各需要多少次盘I/O操作?**

读取5.5KB位置（第2块）

|   方案   | I/O次数 |              访问路径              |
| :------: | :-----: | :--------------------------------: |
| 连续分配 |    1    |     直接计算物理地址：起始块+1     |
| 链接分配 |    2    | 读第1块获取第2块地址 → 读第2块数据 |
|  i-node  |    1    |   直接从i-node的直接地址[1]读取    |

读取16MB+5.5KB位置（第4097块）

|   方案   | I/O次数 |                       访问路径                        |
| :------: | :-----: | :---------------------------------------------------: |
| 连续分配 |    1    |                 直接计算：起始块+4096                 |
| 链接分配 |  4097   |         需要顺序遍历从第1块到第4097块的指针链         |
|  i-node  |    3    | i-node → 二级间接块(第10+1024+3062=4096) → 目标数据块 |



**(4)根据上述情况，分析比较三种文件分配方式的优劣。**

连续分配：

- 优点：随即访问性能最高（O(1))，顺序访问效率高适合流式数据，实现简单。
- 缺点：外部碎片严重，文件扩展困难而且需要预分配空间。

链接分配：

- 优点：无外部碎片，动态曾长灵活，实现相对简单。
- 缺点：随即访问性能差（O(n))，可靠性问题（指针损坏导致数据丢失）以及空间开销问题。

i-node 分配：

- 优点：平衡的随机访问性能（O(1) ~ O(3))，无外部碎片，支持超大文件以及支持文件洞（稀疏文件）。
- 缺点：实现复杂，小文件有元数据开销以及间接块需要额外 I/O。

总结：

- 数据库系统：i-node分配（优化二级间接块缓存）
- 多媒体存储：连续分配（预分配大块空间）
- 通用系统：i-node+extent混合分配（如EXT4）